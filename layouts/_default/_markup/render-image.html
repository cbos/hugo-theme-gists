{{- $u := urls.Parse .Destination -}}
{{- $src := $u.String -}}
{{- if not $u.IsAbs -}}
  {{- $path := strings.TrimPrefix "./" $u.Path -}}
  {{- with or (.PageInner.Resources.Get $path) (resources.Get $path) -}}
    {{- $src = .RelPermalink -}}
    {{- with $u.RawQuery -}}
      {{- $src = printf "%s?%s" $src . -}}
    {{- end -}}
    {{- with $u.Fragment -}}
      {{- $src = printf "%s#%s" $src . -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

  <!-- Checks if page is part of section and page is not section itself -->
  {{- if and (ne .Page.Kind "section") (.Page.Section ) }}
  <!-- Generate a unique id for each image -->
  {{- $random := (substr (md5 .Destination) 0 5) }}
  <input type="checkbox" id="zoomCheck-{{$random}}" hidden>
  <label for="zoomCheck-{{$random}}">
    <img class="zoomCheck" loading="lazy" decoding="async"
         src="{{ $src }}" alt="{{ .PlainText }}"
         {{- with .Title }} title="{{ . }}" {{- end -}} />
  </label>
{{- else }}
<img src="{{ $src }}" alt="{{ .PlainText }}"
  {{- with .Title }} title="{{ . }}" {{- end -}}
  {{- range $k, $v := .Attributes -}}
    {{- if $v -}}
      {{- printf " %s=%q" $k ($v | transform.HTMLEscape) | safeHTMLAttr -}}
    {{- end -}}
  {{- end -}}
>
{{- end }}
{{- /**/ -}}
